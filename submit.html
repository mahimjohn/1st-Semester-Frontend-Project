<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Test Results</title>
  <link rel="stylesheet" href="submit.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
    crossorigin="anonymous">
</head>
<body>
  <main class="exam-card">
    <div class="score-wrap">
      <div class="score-circle" aria-hidden="true">
        <div id="text1" class="text1">You Scored</div>
        <div id="final-percent" class="score">75%</div>
        <div id="text2" class="text2">11 Out Of 15</div>
      </div>

      <div class="actions">
        <div class="result-message">Success</div>
        <div id="inspire-msg" class="inspire-message"></div>
        <button class="btn btn-success" id="return-home">Return Home</button>
      </div>
    </div>
  </main>

  <script>
  // Robust submit page script.
  document.addEventListener('DOMContentLoaded', () => {
    const percentEl = document.getElementById("final-percent");
    const text2El = document.getElementById("text2");
    const resultMsgEl = document.querySelector(".result-message");
    const inspireEl = document.getElementById("inspire-msg");
    const homeBtn = document.getElementById("return-home");

    // read stored result
    let data = null;
    try {
      data = JSON.parse(localStorage.getItem("lastQuizResult") || "null");
    } catch (e) {
      console.warn("Could not parse lastQuizResult:", e);
    }

    if (data && (data.score !== undefined || data.percent !== undefined)) {
      const pct = (data.percent !== undefined) ? data.percent : Math.round((data.score/data.total)*100);
      percentEl.textContent = (pct !== undefined && !Number.isNaN(pct)) ? pct + "%" : "--%";
      text2El.textContent = (data.score !== undefined && data.total !== undefined) ? `${data.score} Out Of ${data.total}` : "";

      if (pct >= 80) resultMsgEl.textContent = "Excellent!";
      else if (pct >= 60) resultMsgEl.textContent = "Success";
      else resultMsgEl.textContent = "Keep Trying";

      const quotes = [
        "Every step forward makes you stronger.",
        "Great achievements begin with small efforts.",
        "You're improving — keep pushing!",
        "Success is built one answer at a time.",
        "Believe in yourself — you're capable of more!"
      ];
      inspireEl.textContent = quotes[Math.floor(Math.random() * quotes.length)];
    } else {
      resultMsgEl.textContent = "No result available";
      inspireEl.textContent = "Take the test to see your results here.";
      percentEl.textContent = "--%";
      text2El.textContent = "";
    }

    // Return Home - robust redirect
    if (!homeBtn) {
      console.warn("Return Home button not found.");
      return;
    }

    homeBtn.addEventListener('click', async () => {
      // Preferred target - change if your file is different
      const preferred = "FrontEnd_Assignment.html";
      const fallbacks = ["index.html", "test_page.html", "FrontEnd_Assignment.html"];

      console.log("Return Home clicked; attempting to navigate to", preferred);

      // Try to navigate to preferred first. If it results in 404, browser will show that page.
      // To be robust in dev environments, we attempt a HEAD request to see if the file exists (works on HTTP).
      try {
        // If running over file://, fetch HEAD will fail — catch and fallback to direct assign.
        const base = window.location.origin;
        // Try HEAD to preferred
        try {
          const resp = await fetch(preferred, { method: "HEAD" });
          if (resp.ok) { window.location.href = preferred; return; }
        } catch (e) {
          // HEAD failed (maybe file://). Try direct navigation anyway.
          console.warn("HEAD check failed for preferred path (likely file://). Attempting direct navigation.");
          window.location.href = preferred;
          return;
        }

        // preferred not found; try fallbacks sequentially
        for (const p of fallbacks) {
          try {
            const r = await fetch(p, { method: "HEAD" });
            if (r.ok) { window.location.href = p; return; }
          } catch (err) {
            // ignore and continue
          }
        }

        // final fallback: go back in history
        if (window.history.length > 1) {
          window.history.back();
        } else {
          // last resort: navigate to first fallback
          window.location.href = fallbacks[0];
        }
      } catch (err) {
        console.error("Redirect failed, falling back to history.back()", err);
        try { window.history.back(); } catch(e) {}
      }
    });
  });
  </script>
</body>
</html>
